<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Name That Chart</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/materialize/css/materialize.min.css') }}"
          media="screen,projection"/>
    <!-- Bootstrap Styles-->
    <link href="{{ url_for('static', filename='assets/css/bootstrap.css') }}" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="{{ url_for('static', filename='assets/css/font-awesome.css') }}" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="{{ url_for('static', filename='assets/css/custom-styles.css') }}" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
</head>
<body>
{% include 'nav.html' %}

<!-- /. NAV SIDE  -->
<div id="page-wrapper">
    <div class="header">
        <h1 class="page-header">
            Administration
            <small>Statistics</small>
        </h1>
    </div>
    <div id="page-inner">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-6">

                <div class="card horizontal cardIcon">
                    <div class="card-image blue waves-effect waves-dark" id="up">
                        <i class="fa fa-upload fa-5x "></i>
                    </div>
                    <div class="card-stacked">
                        <div class="card-content">
                            <h3>Upload </h3>
                        </div>
                        <div class="card-action">
                            <div class="switch">
                                <label>
                                    D3js
                                    <input type="checkbox">
                                    <span class="lever"></span>
                                    Image
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-xs-12 col-sm-6 col-md-6">

                <div class="card horizontal cardIcon ">
                    <div class="card-image blue waves-effect waves-dark" id="down">
                        <i class="fa fa-download fa-5x"></i>
                    </div>
                    <div class="card-stacked">
                        <div class="card-content">
                            <h3>Download</h3>
                        </div>
                        <div class="card-action">
                            <div class="switch">
                                <label>
                                    CSV
                                    <input type="checkbox" id="tp">
                                    <span class="lever"></span>
                                    JSON
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <div class="row">

            <div class="col-md-6">
                <div class="card">
                    <div class="card-action">
                        Textual stats
                    </div>
                    <div class="card-content">
                        <div id="morris-donut-chart"></div>

                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-action">
                        Multiple stats
                    </div>
                    <div class="card-content">
                        Bar chart of Multiple results

                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-md-6">
                <div class="card">
                    <div class="card-action">
                        Most active users
                    </div>
                    <div class="card-content">
                        <div class="table-responsive">
                            <div id="dataTables-example_wrapper" class="dataTables_wrapper form-inline" role="grid">
                                <table class="table table-striped table-bordered table-hover dataTable no-footer"
                                       id="dataTables" aria-describedby="dataTables-example_info">
                                    <thead>
                                    <tr role="row">
                                        <th class="sorting_asc" tabindex="0" aria-controls="dataTables-example"
                                            rowspan="1" colspan="1" aria-sort="ascending"
                                            aria-label="Rendering engine: activate to sort column ascending"
                                            style="width: 276px;"><strong>#</strong>
                                        </th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTables-example" rowspan="1"
                                            colspan="1" aria-label="Browser: activate to sort column ascending"
                                            style="width: 399px;">Number of Post
                                        </th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTables-example" rowspan="1"
                                            colspan="1" aria-label="Platform(s): activate to sort column ascending"
                                            style="width: 369px;">Number of Skip
                                        </th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTables-example" rowspan="1"
                                            colspan="1" aria-label="Engine version: activate to sort column ascending"
                                            style="width: 237px;">Number of submit
                                        </th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTables-example" rowspan="1"
                                            colspan="1" aria-label="CSS grade: activate to sort column ascending"
                                            style="width: 173px;">Average submit time (ms)
                                        </th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTables-example" rowspan="1"
                                            colspan="1" aria-label="CSS grade: activate to sort column ascending"
                                            style="width: 173px;">Average skip time (ms)
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="tbody">

                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-action">
                        Few numbers
                    </div>
                    <div class="card-content">
                        number of chart types, with or without url
                    </div>
                </div>
            </div>
        </div>
        <!-- /. PAGE INNER  -->
    </div>

    <!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  -->
<!-- JS Scripts-->
<!-- jQuery Js -->
<script src="{{ url_for('static', filename='assets/js/jquery-1.10.2.js') }}"></script>

<!-- Bootstrap Js -->
<script src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>

<script src="{{ url_for('static', filename='assets/materialize/js/materialize.min.js') }}"></script>

<!-- Metis Menu Js -->
<script src="{{ url_for('static', filename='assets/js/jquery.metisMenu.js') }}"></script>

{{ url_for('static', filename='') }}
<script src="{{ url_for('static', filename='assets/js/morris/raphael-2.1.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/morris/morris.js') }}"></script>


<script src="{{ url_for('static', filename='assets/js/easypiechart.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/easypiechart-data.js') }}"></script>

<script src="{{ url_for('static', filename='assets/js/Lightweight-Chart/jquery.chart.js') }}"></script>

<script src="{{ url_for('static',filename='assets/js/dataTables/jquery.dataTables.js')}}"></script>


<script type="text/javascript">
    $(document).ready(function () {

        $.ajax({
            type: "GET",
            url: "../firstrow",

            success: function (data) {
                data = JSON.parse(data);
                var i = 0;
                var numbers = ['first', 'second', 'third', 'fourth'];

                Morris.Donut({

                    element: 'morris-donut-chart',
                    data: [{
                        label: data[0][1],
                        value: data[0][2]
                    }, {
                        label: data[1][1],
                        value: data[1][2]
                    }, {
                        label: data[2][1],
                        value: data[2][2]
                    },
                        {
                            label: data[3][1],
                            value: data[3][2]
                        }
                    ],
                    colors: [
                        '#2a4d69', '#4b86b4',
                        '#adcbe3', '#63ace5'
                    ],
                    resize: true
                });


            }
        });


        $.ajax({
            type: "GET",
            url: "../userstats",

            success: function (data) {
                data = JSON.parse(data);
                var i = 1;
                var tr = "";
                var keys = ['id', 'posted', 'skipped', "submitted", 'averageSub', 'averageSkip'];
                data.forEach(function (row) {
                    i = i * -1;
                    if (i < 0) {
                        tr = "<tr class='gradeA even'>";
                    } else {
                        tr = "<tr class='gradeA odd'>";
                    }
                    for (var z = 0; z < keys.length; z++) {

                        tr += "<td>" + row[keys[z]] + "</td>";
                    }
                    tr += "</tr>";
                    $("#tbody").append(tr);
                });


            }
        });


    });

    $('.donut-chart').cssCharts({type: "donut"}).trigger('show-donut-chart');

    $("#up").click(function () {

        window.location = "../upload"

    });

    $("#down").click(function () {
        var type = $("#tp").val();
        if (type == "on") {
            $.ajax({
                type: "GET",
                url: "../db2csv",
                success: function (data) {
                    var test_array = eval("[" + data + "]");
                    var csvContent = "data:text/csv;charset=utf-8,LogID,UserID,UserIP,Timestamp,DateTime,Event,ImageID,Type\n";
                    test_array.forEach(function (infoArray, index) {
                        infoArray.forEach(function (dato) {
                            dataString = dato.join();
                            csvContent += index < infoArray.length ? dataString + "\n" : dataString;
                        });
                    });
                    var encodedUri = encodeURI(csvContent);
                    saveAs(encodedUri, "data.csv")
                }
            })

        } else {
            $.ajax({
                type: "GET",
                url: "../db2csv",
                success: function (data) {
                    var test_array = eval("[" + data + "]");
                    var csvContent = "data:text/json;charset=utf-8,{classification : [\n";
                    test_array.forEach(function (infoArray, index) {
                        infoArray.forEach(function (dato) {

                            csvContent += "\t{ LogID: " + dato[0] + " , " + " UserID : " + dato[1] + " , " + " UserIP : '" + dato[2] +
                                    " ', " + " Timestamp : '" + dato[3] + "' , " + " DateTime : '" + dato[4] + " ', " + " Event :' " + dato[5] +
                                    "' , " + " ImageID : " + dato[6] + " , " + " Type : " + dato[7] + " },\n"
                        });
                    });
                    var res = setCharAt(csvContent, csvContent.length - 1, "");
                    res = setCharAt(csvContent, csvContent.length - 1, "");
                    res += " \n] }";
                    var encodedUri = encodeURI(res);
                    saveAs(encodedUri, "data.json")
                }
            })

        }
    });


    function setCharAt(str, index, chr) {
        if (index > str.length - 1) return str;
        return str.substr(0, index) + chr + str.substr(index + 1);
    }

    function saveAs(uri, filename) {
        var link = document.createElement('a');
        if (typeof link.download === 'string') {
            document.body.appendChild(link); // put the link into the body
            link.download = filename;
            link.href = uri;
            link.click();
            document.body.removeChild(link); // remove the link when done
        } else {
            location.replace(uri);
        }
    }

    $('#tp').change(function () {

        if ($(this).val() == 'on') {
            $(this).val('off');
        } else {
            $(this).val('on');
        }
    });


</script>


</div>


</body>

</html>