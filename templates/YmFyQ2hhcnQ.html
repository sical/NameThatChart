<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Name That chart</title>
    <!-- custom Styles-->
    <link href="{{ url_for('static', filename='assets/css/custom-styles.css') }}" rel="stylesheet"/>
</head>
<style>
    body {
        font: 10px sans-serif;
        text-anchor: middle;
    }
</style>
<body>
<div id="dispres">
    <script src="{{ url_for('static', filename='assets/js/jquery-1.10.2.js') }}"></script>
    <svg id="svg" width="620" height="350"></svg>
</div>
<!-- load the d3.js library -->
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    // set the dimensions and margins of the graph

    var margin = {top: 20, right: 20, bottom: 30, left: 40},
            width = 620 - margin.left - margin.right,
            height = 350 - margin.top - margin.bottom;

    // set the ranges
    var x = d3.scaleBand()
            .range([0, width])
            .padding(0.1);
    var y = d3.scaleLinear()
            .range([height, 0]);

    var color = d3.scaleOrdinal(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00", "#fafbb7", "#e3f9a4", "#facbfb", "#ff7070", "#cdf5f9"]);

    // append the svg object to the body of the page
    // append a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

    // get the data
    var bob = {};
    $.ajax({
        type: "GET",
        url: "../getrandomint",

        success: function (data) {
            bob = JSON.parse(data);
            var datas = bob.res;


            // Scale the range of the data in the domains
            x.domain(datas.map(function (d) {
                return d.name;
            }));
            y.domain([0, d3.max(datas, function (d) {
                return d.key;
            })]);

            // append the rectangles for the bar chart
            svg.selectAll(".bar")
                    .data(datas)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) {
                        return x(d.name);
                    })
                    .attr("width", x.bandwidth())
                    .attr("y", function (d) {
                        return y(d.key);
                    })
                    .attr("height", function (d) {
                        return height - y(d.key);
                    })
                    .attr("fill", function (d) {
                        console.log(d)
                        return getRandomColor();
                    });

            // add the x Axis
            svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

            // add the y Axis
            svg.append("g")
                    .call(d3.axisLeft(y));
        }
    });

</script>
</body>