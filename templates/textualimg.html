<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Name That Chart</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/materialize/css/materialize.min.css') }}"
          media="screen,projection"/>
    <!-- Bootstrap Styles-->
    <link href="{{ url_for('static', filename='assets/css/bootstrap.css') }}" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="{{ url_for('static', filename='assets/css/font-awesome.css') }}" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="{{ url_for('static', filename='assets/css/custom-styles.css') }}" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
</head>
<body>
{% include 'nav.html' %}

<!-- /. NAV SIDE  -->
<div id="page-wrapper">

    <h1 class="page-header" id="brand">
        Describe this chart with your own words
    </h1>

    <div class="row">
        <div id="pop" class="alert" style="display: none">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            Success, it is saved
        </div>
    </div>
    <div id="page-inner">
        <div class="row">

            <div class="col-lg-12">
                <div class="card">
                    <div class="card-content" style="padding-bottom:5%">
                        <img style="width: 20%;height: auto" id="dispres" src=""/>
                        <div class="row">


                            <div id="fom">
                                <input id="value" type="text" name="type" placeholder="What is this chart ?"
                                       maxlength="50"/>
                                <div id="btn">
                                <button id="skip" class="waves-effect waves-light btn grey">skip
                                </button>
                                <button id="save" class="waves-effect waves-light btn ">
                                    save
                                </button>
                                    <div>
                            </div>


                        </div>
                    </div>
                </div>

            </div>


        </div>


        <!-- /. PAGE INNER  -->
    </div>

    <!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  -->
<!-- JS Scripts-->
<!-- jQuery Js -->
<script src="{{ url_for('static', filename='assets/js/jquery-1.10.2.js') }}"></script>

<!-- Bootstrap Js -->
<script async src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>

<script async src="{{ url_for('static', filename='assets/materialize/js/materialize.min.js') }}"></script>

<script type="text/javascript">
    var started = true;
    $(document).ready(function () {
        console.log(window.location.href);

        $.ajax({
            type: "GET",
            url: "../getnextimg",
            processData: false,
            success: function (data) {

                $("#dispres").attr("src", data);
                furm = new FormData();
                furm.append("action", "page loaded");
                $.ajax({
                    type: "POST",
                    url: "../logaction",
                    processData: false,
                    contentType: false,
                    data: furm
                });
            }
        });
    });


    $("#save").click(function () {

        var text = $("#value").val();
        $("#value").val('');
        $("#pop").show();
        var form = new FormData();

        var reg = /[\(,\)\\~\`\"\{\}\+\=\#\&\][^²;:\\\/£$*¤µ¨%§!?.&\n\r><@]*/ig;
        text = text.replace(reg, "");
        form.append("name", text);


        $.ajax({
            type: "POST",
            url: "./savetext",
            enctype: 'mulipart/form-data',
            processData: false,
            contentType: false,
            data: form,
            success: function () {
                if (window.location.href.indexOf('hybrid') !== -1) {
                    window.location = "../hybrid"
                } else {
                    $.ajax({
                        type: "GET",
                        url: "../getnextimg",
                        processData: false,
                        contentType: false,
                        success: function (data) {


                            $("#dispres").attr("src", data);
                        }
                    });
                }
            }
        });


    });

    $("#skip").click(function () {
        firm = new FormData();
        firm.append("action", "skip");
        $.ajax({
            type: "POST",
            url: "../logaction",
            processData: false,
            contentType: false,
            data: firm
        });
        if (window.location.href.indexOf('hybrid') !== -1) {
            window.location = "../hybrid"
        } else {
            $.ajax({
                type: "GET",
                url: "../getnextimg",
                processData: false,
                contentType: false,
                success: function (data) {


                    $("#dispres").attr("src", data);
                }
            });
        }

    });


    $("#value").on('input', function () {
        if ($("#value").val() != undefined) {
            if ($("#value").val().length == 1 && started) {
                started = false;
                firm = new FormData();
                firm.append("action", "started typing");
                $.ajax({
                    type: "POST",
                    url: "../logaction",
                    processData: false,
                    contentType: false,
                    data: firm
                });
            }
        }
    });
</script>

</body>

</html>